This is the code for a model-checker for Probabilistic Computational Tree Logic (PCTL) over Discrete-Time Markov Chains (DTMC) written in prolog (for [SICStus prolog](https://sicstus.sics.se/)), and implemented in ProB.

Before a presentation of the model-checker some useful comments about it, here's how the files are ordered :
- The examples contains 4 different models used for benchmarking. They can countain :
    - An [XTL](https://prob.hhu.de/w/index.php?title=Other_languages) version of the model, used to run the model-checker with [ProB](https://prob.hhu.de/w/index.php?title=The_ProB_Animator_and_Model_Checker).
    - A [PRISM](https://www.prismmodelchecker.org/) version of the model, as well as a list of pctl formulas over it
    - A B-machine representation of the model
    - A prolog representation of the model, used for tests with the prolog version of the model-checker
    - A prolog state space generated by the ProB from a B machine
- The version of the model-checker which is implemented in the ProB core
- A prolog version of the model-checker, working on its own, used for testing, as well as some archives of different approach studied for the model-checker.
  
## The model checker
The main idea behind writing such a model-checker, particularly when already [great and fast probabilistic model-checker](https://www.prismmodelchecker.org/) exist, is to benefit from the power of the B syntax and to make it easier to use it from model-checking tools like ProB without rewriting entirely the model. This is why the model-checker had been written in Prolog.

However, note that it is at no point intended to extend the B syntax in order to accept probabilities. See *Probabilistic termination in B, AK McIver, CC Morgan, Thai Son Hoang (2003)*


One other argument is that, for [bounded formulas](#pctl), the model-checker works dynamicly, which means that it does not need to explore the full state space (which may be infinite) to perform the checking of a formula.

Note that there is currently no kind of trace counter-example implemented. See [*Probabilistic Model Checking: Advances and Applications, Marta Kwiatkowska, Gethin Norman, David Parker. p.42*](https://www.cs.ox.ac.uk/people/david.parker/papers/fsv-pmc.pdf) for more information on that topic

## PCTL syntax {#pctl}
*For an introduction to PCTL and DTMC, look at the [PRISM lecture notes](https://www.prismmodelchecker.org/lectures/pmc/)*

The idea of PCTL is to specify temporal properties on a model while taking into account probabilities.

For instance, the formula $P_{<{0.75}}[X {finished}]$ states that the probability that the next state verify the property "finished" is strictly less than 0.75.

The PCTL formulas accpted by the [parser](https://github.com/hhu-stups/probparsers/tree/PCTLparser/ltlparser) are separated onto 2 categories : path formulas and state formulas.

A state formula $\phi$ is either :
- *true*
- *false*
- {property}, with property being defined on the dtmc
- $\phi_{1}$ & $\phi_{2}$
- $\phi_{1}$ or $\phi_{2}$
- $\phi_{1} \rightarrow \phi_{2}$
- $\phi_{1} \leftrightarrow \phi_{2}$
- not $\phi$
- $P_{op\{probability\}}[\Phi]$, with $op \in \{<,>,\le,\ge\}$, probability beign either a variable or a number between 0 and 1, and $\Phi$ being a path formula.

A path formula $\Phi$ is either :
- X $\phi$, the next operator, with $\phi$ being a state formula
- F $\phi$, the eventually operator
- F $\le{k}$ $\phi$ with $k$ being an integer different than 0, the bounded eventually operator
- G $\phi$, the always operator
- G $\le{k}$ $\phi$ the bounded always operator
- $\phi_{1}$ U $\phi_{2}$, the until operator
- $\phi_{1}$ U $\le{k}$ $\phi_{2}$, the bounded until operator

Note that, as in PRISM, the syntax is extented to add = as an operator in a probabilistic path formula. This allow to evaluate the probability of a path from a certain state

To evaluate such a formula using ProB, you have to [load a model](https://prob.hhu.de/w/index.php?title=Using_the_Command-Line_Version_of_ProB) into the [REPL](https://prob.hhu.de/w/index.php?title=ProB_REPL) and to enter the formula you want to verify as `:pctl formula`


## Perspectives

For now, the model-checking works on prob only on XTL models, using the XTL extention system. It would be great to have the possibility to add probabilities directly over a B model, for instance to use variables present on the model.

The direction chosen for the model-checking of bounded formulas is quite different from the one used by PRISM, a good aspect of it is that it is dynamic and doesn't require to have the whole state-space available to refute or accept a formula. However, the speed goes down as the bound is increasing. Maybe some improvement could be done here to find a better solution that mix the pros and cons of both approaches.


The model-checking of unbounded formulas require to solve a linear equation. This is done in prolog using CLP(R), but this is arguably not the fastest solution, and in top of that, it doesn't estimate the error on the calculus, which would be definitely interesting for the use we make of it. 

As shown in the archives, the precomputation needed for the model-checking of unbounded formula isn't optimal, and more investigation on that would be interesting to improve the speed of the model-checker